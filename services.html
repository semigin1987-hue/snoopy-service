<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const gameSection = document.getElementById('game-section');
    let gameActive = false;
    let score = 0;
    let basket = { x: 170, y: 400, w: 70, h: 10 };
    let items = [];

    function toggleGame() {
        gameActive = !gameActive;
        gameSection.style.display = gameActive ? 'block' : 'none';
        
        if (gameActive) {
            resizeCanvas();
            resetGame();
            setTimeout(() => {
                gameSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
            requestAnimationFrame(update);
        }
    }

    function resizeCanvas() {
        canvas.width = gameSection.offsetWidth;
        canvas.height = gameSection.offsetHeight;
        basket.y = canvas.height - 40;
        basket.x = (canvas.width / 2) - (basket.w / 2);
    }

    function resetGame() {
        score = 0;
        items = [];
        updateScore();
    }

    function updateScore() {
        document.getElementById('score-board').innerText = 'SCORE: ' + score;
    }

    function spawnItem() {
        if (Math.random() < 0.035) {
            const isVirus = Math.random() < 0.3;
            items.push({
                x: Math.random() * (canvas.width - 25),
                y: -30,
                speed: 3 + (score / 15),
                isVirus: isVirus
            });
        }
    }

    function update() {
        if (!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        spawnItem();

        ctx.fillStyle = '#ff9100';
        ctx.fillRect(basket.x, basket.y, basket.w, basket.h);

        items.forEach((item, i) => {
            item.y += item.speed;
            ctx.font = '24px Arial';
            ctx.fillText(item.isVirus ? 'ðŸ‘¾' : 'âš™ï¸', item.x, item.y);

            if (item.y > basket.y - 10 && item.y < basket.y + 10 && 
                item.x > basket.x - 10 && item.x < basket.x + basket.w) {
                if (item.isVirus) {
                    alert('SYSTEM OVERLOAD! Ð¢Ð²Ñ–Ð¹ Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº: ' + score);
                    toggleGame();
                } else {
                    score++;
                    updateScore();
                    items.splice(i, 1);
                }
            }
            if (item.y > canvas.height) items.splice(i, 1);
        });
        requestAnimationFrame(update);
    }

    // --- Ð¤Ð£ÐÐšÐ¦Ð†Ð¯ ÐšÐ•Ð Ð£Ð’ÐÐÐÐ¯ (Ð¡ÐŸÐ†Ð›Ð¬ÐÐ Ð”Ð›Ð¯ ÐŸÐš Ð¢Ð Ð¢Ð•Ð›Ð•Ð¤ÐžÐÐ£) ---
    function moveBasket(clientX) {
        const rect = canvas.getBoundingClientRect();
        let newX = clientX - rect.left - basket.w / 2;
        if (newX >= 0 && newX <= canvas.width - basket.w) {
            basket.x = newX;
        }
    }

    // Ð¡Ð»ÑƒÑ…Ð°Ñ”Ð¼Ð¾ Ð¼Ð¸ÑˆÐºÑƒ (ÐŸÐš)
    gameSection.addEventListener('mousemove', (e) => {
        if (gameActive) moveBasket(e.clientX);
    });

    // Ð¡Ð»ÑƒÑ…Ð°Ñ”Ð¼Ð¾ Ñ‚Ð°Ñ‡ (Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½)
    gameSection.addEventListener('touchmove', (e) => {
        if (gameActive) {
            moveBasket(e.touches[0].clientX);
            e.preventDefault();
        }
    }, { passive: false });

    window.onresize = resizeCanvas;
</script>
